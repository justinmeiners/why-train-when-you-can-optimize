<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Drawing template</title>
<link rel="stylesheet" href="google-code-prettify/prettify.css">
<link rel="stylesheet" href="styles/prettify-theme.css">
<script defer src="google-code-prettify/prettify.js"></script>
<script defer src="google-code-prettify/run_prettify.js"></script>
<link rel="stylesheet" href="styles/main.css">
</head>

<!-- Generated by srcweave https://github.com/justinmeiners/srcweave -->
<h1>Drawing template<a id="c0"></a></h1>


<p>This is the code that sets up the drawing canvas as well as the HTML page.</p>

<div class="code-block">
<span class="block-header">
<strong class="block-title"><em><a id="bsim_definition:5" href="#bsim_definition:5">sim definition</a></em></strong></span>
<pre class="prettyprint"><code class="">function Sim() {
    this.canvas = document.getElementById('main-canvas');
    this.ctx = this.canvas.getContext('2d', { alpha: false });

    this.canvas.onmousedown = this.mouseDown.bind(this);
    this.canvas.onmouseup = this.mouseUp.bind(this);
    this.canvas.onmouseout = this.mouseOut.bind(this);
    this.canvas.onmousemove = this.mouseMove.bind(this);

    this.shapes = [];
};

<em class="block-link nocode" title="template.lit:22"><a href="#bsim_input:21">@{sim input}</a></em>
</code></pre>
<p class="block-usages"><small>Used by <a href="#b/draw.js:134" title="template.lit:135 /draw.js">1</a> </small></p></div>




<div class="code-block">
<span class="block-header">
<strong class="block-title"><em><a id="bsim_input:21" href="#bsim_input:21">sim input</a></em></strong></span>
<pre class="prettyprint"><code class="">document.getElementById("clear-button").onclick = function() {
    sim.shapes = [];
    drawSim();
};

function getMousePos(canvas, e) {
    var rect = canvas.getBoundingClientRect();
    return new Vec(e.clientX - rect.left, e.clientY - rect.top);
}

Sim.prototype.mouseDown = function(e) {
    var mp = getMousePos(this.canvas, e);
    this.path = [];
    this.path.push(mp);
    this.dragging = true;

    e.preventDefault();
};

Sim.prototype.mouseMove = function(e) {
    var mp = getMousePos(this.canvas, e);

    if (this.dragging) {
        var lp = this.path[this.path.length - 1];

        if (!mp.inCircle(lp, 6)) {
            this.path.push(mp);
            drawSim();
        }
    }
}

Sim.prototype.mouseUp = function(e) {
    if (!this.dragging) return;
    var mp = getMousePos(this.canvas, e);
    this.path.push(mp);
    this.endDrag(e);
}

Sim.prototype.mouseOut = function(e) {
    if (!this.dragging) return;
    this.endDrag(e);
}

Sim.prototype.endDrag = function(e) {
    var corrected = tryShapeFit(this.path);
    if (corrected) {
        this.shapes.push(corrected);
    } else {
        this.shapes.push({
            path: this.path
        });
    }

    this.path = [];
    this.dragging = false;
    drawSim();
}
</code></pre>
<p class="block-usages"><small>Used by <a href="#bsim_definition:5" title="template.lit:6 sim definition">1</a> </small></p></div>




<div class="code-block">
<span class="block-header">
<strong class="block-title"><em><a id="bsim_rendering:83" href="#bsim_rendering:83">sim rendering</a></em></strong></span>
<pre class="prettyprint"><code class="">function drawSim() {
    var ctx = sim.ctx;
    ctx.lineWidth = 1;
    clearCanvas(ctx, sim.canvas);

    ctx.lineWidth = 2;
    ctx.strokeStyle = "#000000";
    for (var i = 0; i &lt; sim.shapes.length; ++i) {
        var s = sim.shapes[i];
        if (s.path) {
            drawPath(ctx, s.path);
        } else if (s.circle) {
            ctx.beginPath();
            ctx.arc(s.circle.origin.x, s.circle.origin.y, s.circle.radius, 0.0, Math.PI * 2.0);
            ctx.closePath();
            ctx.stroke();
        } else if (s.ellipse) {
            ctx.beginPath();
            ctx.ellipse(s.ellipse.origin.x, s.ellipse.origin.y, s.ellipse.size.x, s.ellipse.size.y, 0, 0.0, Math.PI * 2.0);
            ctx.closePath();
            ctx.stroke();
        }
    }

    ctx.lineWidth = 3;
    ctx.strokeStyle = "#FF0000";
    if (sim.path) {
        drawPath(ctx, sim.path);
    }
}

function clearCanvas(ctx, canvas) {
    ctx.fillStyle = '#C1FFC9';
    ctx.beginPath();
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.closePath();
    return ctx.fill();
}

function drawPath(ctx, path) {
    if (path.length === 0) return;
    ctx.beginPath();
    ctx.moveTo(path[0].x, path[0].y);
    for (var i = 1; i &lt; path.length; ++i) {
        ctx.lineTo(path[i].x, path[i].y);
    }
    ctx.stroke();
}
</code></pre>
<p class="block-usages"><small>Used by <a href="#b/draw.js:134" title="template.lit:135 /draw.js">1</a> </small></p></div>




<div class="code-block">
<span class="block-header">
<strong class="block-title"><em><a id="b/draw.js:134" href="#b/draw.js:134">/draw.js</a></em></strong></span>
<pre class="prettyprint"><code class="">// Created by Justin Meiners (2022)
// License: MIT

"use strict";
<em class="block-link nocode" title="template.lit:6"><a href="#bsim_definition:5">@{sim definition}</a></em>
<em class="block-link nocode" title="template.lit:84"><a href="#bsim_rendering:83">@{sim rendering}</a></em>

var sim = new Sim();
drawSim();
</code></pre>
</div>


<h3>HTML page</h3>

<p>Here is the HTML page I use.</p>

<div class="code-block">
<span class="block-header">
<strong class="block-title"><em><a id="b/index.html:150" href="#b/index.html:150">/index.html</a></em></strong></span>
<pre class="prettyprint"><code class="">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Drawing assistant&lt;/title&gt;
    &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
           &lt;p&gt;
               &lt;a href="/why-train-when-you-can-optimize"&gt;Back to article&lt;/a&gt;
           &lt;/p&gt;

           &lt;canvas id="main-canvas" width="1024" height="768"&gt;&lt;/canvas&gt;
           &lt;p&gt;
              &lt;button id="clear-button"&gt;Clear&lt;/button&gt;
           &lt;/p&gt;

           &lt;script src="math.js"&gt;&lt;/script&gt;
           &lt;script src="assist.js"&gt;&lt;/script&gt;
           &lt;script src="draw.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
</div>



</body>
</html>
